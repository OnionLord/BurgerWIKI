package vr.mid.burgerdictionary;

import java.util.ArrayList;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.Statement;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.os.StrictMode;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.BaseAdapter;
import android.widget.Button;
import android.widget.ListView;
import android.widget.RadioButton;
import android.widget.RadioGroup;
import android.widget.TextView;

public class BurgerList extends Activity {
	
	ArrayList<BurgerInfo> info;
	private String category;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.burgerlist);
		info = new ArrayList<BurgerInfo>();
		Intent intent = getIntent();
		category = intent.getExtras().getString("category");
		
		//(int no, String name, String company, float calone, float calset,
		//		int priceone, int priceset, String image)
		
		
		getDataFromDB();
		
		BurgerAdapter bAdap = new BurgerAdapter(this, R.layout.burgeritem, info);
		
		ListView bList;
		bList = (ListView)findViewById(R.id.list_total);
		bList.setAdapter(bAdap);
	}
	
	private void getDataFromDB()
	{
		//String url = "jdbc:mysql://192.168.0.5:3306/mid";
	   // String user = "knumobile";
	    //String pass = "knumobile";
		
		NetInfo db = new NetInfo();
		String url = db.DBURL;
		String user = db.DBID;
		String pass = db.DBPW;
	
	    try {
            Class.forName("com.mysql.jdbc.Driver");
            Connection con = DriverManager.getConnection(url, user, pass);
            /* System.out.println("Database connection success"); */

       
            Statement st = con.createStatement();
            ResultSet rs = null;
            //if(rb_name.)
            if(category.equals("etc"))
            {
                rs = st.executeQuery("select no, name, company, calone, calset, priceone, priceset, image from burger_content where company not in ('맥도날드','롯데리아','KFC','버거킹','맘스터치') order by name");
            }
            else if(category.equals("mc"))
            {
                rs = st.executeQuery("select no, name, company, calone, calset, priceone, priceset, image from burger_content where company='맥도날드' order by name");
            }
            else if(category.equals("ll"))
            {
                rs = st.executeQuery("select no, name, company, calone, calset, priceone, priceset, image from burger_content where company='롯데리아' order by name");
            }
            else if(category.equals("kfc"))
            {
                rs = st.executeQuery("select no, name, company, calone, calset, priceone, priceset, image from burger_content where company='KFC' order by name");
            }
            else if(category.equals("bk"))
            {
                rs = st.executeQuery("select no, name, company, calone, calset, priceone, priceset, image from burger_content where company='버거킹' order by name");
            }
            else if(category.equals("mt"))
            {
                rs = st.executeQuery("select no, name, company, calone, calset, priceone, priceset, image from burger_content where company='맘스터치' order by name");
            }
            else
            {
                rs = st.executeQuery("select no, name, company, calone, calset, priceone, priceset, image from burger_content order by name");
            }
            ResultSetMetaData rsmd = rs.getMetaData();
            /*BurgerInfo b = 
    				new BurgerInfo(1, "싸이버거","맘스터치",437.8,882.8,3200,5400,
    						"http://cfile28.uf.tistory.com/image/17173C3650625BBC06ED33", 
    						"싸이버거<br>가수 싸이와는 관련 없다<br>닭다리살 패티");
    		info.add(b);*/
            while(rs.next()) {
            	BurgerInfo b = new BurgerInfo(rs.getInt("no"), rs.getString("name"), 
            			rs.getString("company"), rs.getDouble("calone"), 
            			rs.getDouble("calset"), rs.getInt("priceone"), 
            			rs.getInt("priceset"), rs.getString("image"));
            	info.add(b);
            }
            st.close();
            rs.close();
            con.close();
            
        }
        catch(Exception e) {
            e.printStackTrace();
            System.out.println(e.toString());
        }
	}
	
	
	public void onClickButton(View v)
	{
		switch(v.getId())
		{
		case R.id.list_btn_back:
			finish();
			break;
		}
	}

	class BurgerAdapter extends BaseAdapter
	{
		Context maincon;
		LayoutInflater Inflater;
		ArrayList<BurgerInfo> blist;
		int layout;
		
		public BurgerAdapter(Context context, int alayout, ArrayList<BurgerInfo> b)
		{
			maincon = context;
			Inflater = (LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
			layout = alayout;
			blist = b;
		}
		
		@Override
		public int getCount() {
			// TODO Auto-generated method stub
			return blist.size();
		}

		@Override
		public Object getItem(int arg0) {
			// TODO Auto-generated method stub
			return blist.get(arg0).getName();
		}

		@Override
		public long getItemId(int arg0) {
			// TODO Auto-generated method stub
			return arg0;
		}

		@Override
		public View getView(int position, View convertView, ViewGroup parent) {
			
			final int pos = position;
			
			if(convertView == null)
			{
				convertView = Inflater.inflate(layout, parent, false);
			}
			TextView txt = (TextView)convertView.findViewById(R.id.item_txt);
			String btxt = blist.get(position).getName() + "("+blist.get(position).getCompany()+")";
			//String btxt =String.format("%-30s(%s)", blist.get(position).getName(),blist.get(position).getCompany());
			txt.setText(btxt);
			
			Button btn = (Button)convertView.findViewById(R.id.item_btn_view);
			
			btn.setOnClickListener(new Button.OnClickListener()
			{
				public void onClick(View v)
				{
					Intent intent = new Intent(BurgerList.this, BurgerView.class);
					intent.putExtra("no",blist.get(pos).getNo());
	            	startActivity(intent);

				}
			});
			
			return convertView;
		}
		
	}
	
	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.burger_list, menu);
		return true;
	}

	@Override
	public boolean onOptionsItemSelected(MenuItem item) {
		// Handle action bar item clicks here. The action bar will
		// automatically handle clicks on the Home/Up button, so long
		// as you specify a parent activity in AndroidManifest.xml.
		int id = item.getItemId();
		if (id == R.id.action_settings) {
			return true;
		}
		return super.onOptionsItemSelected(item);
	}
}
